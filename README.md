
---

# Mutation Analysis Workflow

## Overview

This project provides a comprehensive workflow for mutation data analysis, including **IMD distribution analysis**, **background model generation**, and **data preprocessing**. Users can utilize this tool to automate mutation data processing, construct background models, and calculate analytical metrics such as recommended thresholds, mutation burden, and false discovery rates (FDR).

---

## Modules

### Main Module
- **Function**: The main program orchestrates the core analysis workflow.
- **Input Parameters**:
  - `genome_size_bp`: Genome size in base pairs (e.g., GRCh37 = 3095693983)
  - `output_directory`: Path for simulated background model output
  - `input_file`: Path to input mutation file
  - `outfile_name`: Path for result file (CMCS-ready format)
  - `genome`: Genome version (e.g., GRCh37 or GRCh38)
  - `cancer_type`: Cancer type (e.g., BRCA)
- **Output**:
  - **IMD Distribution Plot**: Visualization comparing real and simulated IMD distributions.
  - **Recommended Threshold (eps)**: Automatically calculates the optimal IMD threshold.
  - **Mutation Burden**: Number of mutations per megabase.
  - **False Discovery Rate (FDR)**: Reflects the reliability of the background model.

---

### Pretreatment Module
- **Function**: Automates processing of mutation files downloaded from the COSMIC database.
  - Retains only single base substitutions (SBS).
  - Enriches data with trinucleotide context information via remote loading.
- **Output**:
  - Processed mutation data files meeting CMCS platform format requirements (with context information).

---

### Background Model Module
- **Function**: Generates simulated mutation data resembling real data distributions, ensuring biological plausibility.
- **Core Features**:
  1. **Chromosomal Proportion and Length Constraints**: Mutation positions are generated based on chromosomal mutation proportions and physical constraints.
  2. **IMD Distribution KDE**: A kernel density estimation (KDE) model is built from real data IMD values to simulate local clustering characteristics.
  3. **Hotspot Regions**: High-density mutation regions (e.g., top 20%) are prioritized for mutation generation.
  4. **Dynamic Starting Points and Incremental Positioning**: Mutation positions are generated by accumulating IMD values from either hotspot or random starting points.
  5. **Randomness and Reproducibility**: Random seeds (`random_state`) are used to ensure reproducibility while retaining randomness in simulations.
  6. **Multiple Simulations**: A total of 1,000 simulated datasets are generated to compute statistical features (e.g., mean cluster count), reducing variability.

---

## Installation and Execution

### Install Dependencies
Run the following command to install all required dependencies:
```bash
pip install -r requirements.txt
```

---

## Run the Main Module

### Modify parameters in `main()`:
```python
genome_size_bp = 3095693983  # Genome size for GRCh37
output_directory = "./simulations_output"
input_file = "./input_file/example/Cosmic_GenomeScreensMutant_Tsv_v99_GRCh37_PD4103a.tsv"
outfile_name = "./output_file/Tsv_v99_GRCh37_PD4103a_BRCA.tsv"
genome = "GRCh37"
cancer_type = "BRCA"


Then run the program:
python main.py

---

##Generated Results：
IMD Distribution Plot: Automatically generated as part of the analysis.
Result File: Saved at the path specified by outfile_name.
Console Output: Mutation burden and false discovery rate (FDR).

##Outputs：
IMD Distribution Plot: Visual comparison of real vs. simulated data.
Threshold IMD (eps): Recommended threshold value for cluster detection.
Mutation Burden: Total mutations per megabase.
False Discovery Rate (FDR): A statistical measure of model reliability.




